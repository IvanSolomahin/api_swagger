openapi: 3.0.0
info:
  title: –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –ü–æ–¥–¥–µ—Ä–∂–∫–∏ –ö–æ–≤–æ—Ä–∫–∏–Ω–≥–∞
  version: 1.0.0
  description: API –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∂–∞–ª–æ–±, –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è —Å–æ —Å–ª—É–∂–±–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏
servers:
  - url: 'https://coworking-api.example.com/support  '

# üîê –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ —Ä–∞–∑–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø—Ä–∞–≤
security:
  - BearerAuth: []

components:
  # üîë –°—Ö–µ–º—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
    RoleCheck:
      type: apiKey
      in: header
      name: X-User-Role

  # üì¶ –°—Ö–µ–º—ã –¥–∞–Ω–Ω—ã—Ö 
  schemas:
    Ticket:
      type: object
      properties:
        id:
          type: integer
          description: –£–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ç–∏–∫–µ—Ç–∞
        userId:
          type: integer
          description: –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        categoryId:
          type: integer
          description: –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
        title:
          type: string
          description: –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Ç–∏–∫–µ—Ç–∞
        description:
          type: string
          description: –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã
        status:
          type: string
          description: –°—Ç–∞—Ç—É—Å —Ç–∏–∫–µ—Ç–∞ ('–æ–∂–∏–¥–∞–µ—Ç', '–≤ –ø—Ä–æ—Ü–µ—Å—Å–µ', '–∑–∞–∫—Ä—ã—Ç')
        attachments:
          type: array
          items:
            type: string
          description: –°–ø–∏—Å–æ–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time
    CreateTicketRequest:
      type: object
      properties:
        userId:
          type: integer
        categoryId:
          type: integer
        title:
          type: string
        description:
          type: string
        attachments:
          type: array
          items:
            type: string
      required: [userId, categoryId, title, description]
    UpdateTicketStatusRequest:
      type: object
      properties:
        status:
          type: string
    Comment:
      type: object
      properties:
        id:
          type: integer
        ticketId:
          type: integer
        authorId:
          type: integer
        text:
          type: string
        createdAt:
          type: string
          format: date-time
    AddCommentRequest:
      type: object
      properties:
        authorId:
          type: integer
        text:
          type: string
      required: [authorId, text]
    Category:
      type: object
      properties:
        id:
          type: integer
        name:
          type: string
        description:
          type: string
    CreateCategoryRequest:
      type: object
      properties:
        name:
          type: string
        description:
          type: string
      required: [name]
    SupportReport:
      type: object
      properties:
        period:
          type: object
          properties:
            startDate:
              type: string
              format: date
            endDate:
              type: string
              format: date
        totalTickets:
          type: integer
        resolvedTickets:
          type: integer
        averageResolutionTime:
          type: string
        categoryDistribution:
          type: object
          additionalProperties:
            type: integer
    GenerateSupportReportRequest:
      type: object
      properties:
        startDate:
          type: string
          format: date
        endDate:
          type: string
          format: date
      required: [startDate, endDate]

# üö¶ –†–∞–∑–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø—Ä–∞–≤ –ø–æ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞–º
paths:
  /tickets:
    get:
      summary: –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Ç–∏–∫–µ—Ç–æ–≤
      security:
        - BearerAuth: []
      tags:
        - –ü–æ–¥–¥–µ—Ä–∂–∫–∞
      parameters:
        - name: userId
          in: query
          description: –§–∏–ª—å—Ç—Ä –ø–æ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
          schema:
            type: integer
        - name: status
          in: query
          description: –§–∏–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å—É —Ç–∏–∫–µ—Ç–∞
          schema:
            type: string
      responses:
        '200':
          description: –£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Ticket'
        '401':
          description: Unauthorized
        '500':
          description: Internal Server Error
    post:
      summary: –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ —Ç–∏–∫–µ—Ç–∞
      security:
        - BearerAuth: []
      tags:
        - –ü–æ–¥–¥–µ—Ä–∂–∫–∞
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateTicketRequest'
      responses:
        '201':
          description: –¢–∏–∫–µ—Ç —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω
          headers:
            Location:
              description: URI –Ω–æ–≤–æ–≥–æ —Ä–µ—Å—É—Ä—Å–∞
              schema:
                type: string
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Ticket'
        '400':
          description: –ù–µ–≤–µ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ –∑–∞–ø—Ä–æ—Å–µ
        '401':
          description: Unauthorized
        '500':
          description: Internal Server Error

  /tickets/{ticketId}:
    get:
      summary: –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Ç–∏–∫–µ—Ç–µ
      security:
        - BearerAuth: []
      tags:
        - –ü–æ–¥–¥–µ—Ä–∂–∫–∞
      parameters:
        - name: ticketId
          in: path
          description: –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ç–∏–∫–µ—Ç–∞
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: –£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Ticket'
        '401':
          description: Unauthorized
        '404':
          description: –¢–∏–∫–µ—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω
        '500':
          description: Internal Server Error
    put:
      summary: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ —Ç–∏–∫–µ—Ç–∞
      security:
        - BearerAuth: []
        - RoleCheck: [ADMIN]
      tags:
        - –ü–æ–¥–¥–µ—Ä–∂–∫–∞
      parameters:
        - name: ticketId
          in: path
          description: –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ç–∏–∫–µ—Ç–∞
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateTicketStatusRequest'
      responses:
        '200':
          description: –°—Ç–∞—Ç—É—Å —Ç–∏–∫–µ—Ç–∞ —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª—ë–Ω
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Ticket'
        '400':
          description: –ù–µ–≤–µ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ –∑–∞–ø—Ä–æ—Å–µ
        '401':
          description: Unauthorized
        '403':
          description: –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤
        '404':
          description: –¢–∏–∫–µ—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω
        '500':
          description: Internal Server Error
    delete:
      summary: –£–¥–∞–ª–µ–Ω–∏–µ —Ç–∏–∫–µ—Ç–∞
      security:
        - BearerAuth: []
        - RoleCheck: [ADMIN]
      tags:
        - –ü–æ–¥–¥–µ—Ä–∂–∫–∞
      parameters:
        - name: ticketId
          in: path
          description: –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ç–∏–∫–µ—Ç–∞
          required: true
          schema:
            type: integer
      responses:
        '204':
          description: –¢–∏–∫–µ—Ç —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª—ë–Ω
        '401':
          description: Unauthorized
        '403':
          description: –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤
        '404':
          description: –¢–∏–∫–µ—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω
        '500':
          description: Internal Server Error

  /tickets/{ticketId}/comments:
    post:
      summary: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è –∫ —Ç–∏–∫–µ—Ç—É
      security:
        - BearerAuth: []
      tags:
        - –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
      parameters:
        - name: ticketId
          in: path
          description: –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Ç–∏–∫–µ—Ç–∞
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AddCommentRequest'
      responses:
        '201':
          description: –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Comment'
        '400':
          description: –ù–µ–≤–µ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ –∑–∞–ø—Ä–æ—Å–µ
        '401':
          description: Unauthorized
        '403':
          description: –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤
        '404':
          description: –¢–∏–∫–µ—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω
        '500':
          description: Internal Server Error

  /categories:
    get:
      summary: –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
      security:
        - BearerAuth: []
      tags:
        - –ö–∞—Ç–µ–≥–æ—Ä–∏–∏
      responses:
        '200':
          description: –£—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Category'
        '401':
          description: Unauthorized
        '500':
          description: Internal Server Error
    post:
      summary: –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
      security:
        - BearerAuth: []
        - RoleCheck: [ADMIN]
      tags:
        - –ö–∞—Ç–µ–≥–æ—Ä–∏–∏
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateCategoryRequest'
      responses:
        '201':
          description: –ö–∞—Ç–µ–≥–æ—Ä–∏—è —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω–∞
          headers:
            Location:
              description: URI –Ω–æ–≤–æ–≥–æ —Ä–µ—Å—É—Ä—Å–∞
              schema:
                type: string
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Category'
        '400':
          description: –ù–µ–≤–µ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ –∑–∞–ø—Ä–æ—Å–µ
        '401':
          description: Unauthorized
        '403':
          description: –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤
        '500':
          description: Internal Server Error

  /reports:
    post:
      summary: –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á–µ—Ç–∞ –ø–æ —Ç–∏–∫–µ—Ç–∞–º
      security:
        - BearerAuth: []
        - RoleCheck: [ADMIN]
      tags:
        - –û—Ç—á–µ—Ç—ã
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GenerateSupportReportRequest'
      responses:
        '200':
          description: –û—Ç—á–µ—Ç —É—Å–ø–µ—à–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SupportReport'
        '400':
          description: –ù–µ–≤–µ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ –∑–∞–ø—Ä–æ—Å–µ
        '401':
          description: Unauthorized
        '403':
          description: –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤
        '500':
          description: Internal Server Error